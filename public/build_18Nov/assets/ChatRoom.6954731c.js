import{T as P}from"./TextInput.618a5da3.js";import{_ as t}from"./Translate.dc83ae5b.js";import{f as L}from"./index.6369b7cd.js";import{d as A}from"./index.aca621cc.js";import{l as N,j as S,k as D}from"./index.dc633638.js";import{Q as d}from"./react-toastify.esm.06aebf17.js";import{r as a,u as k,d as u,j as r,a as s,F as m,h as O}from"./app.64d592ef.js";import R from"./TipPopup.db45f15e.js";import{S as z}from"./SecondaryButton.23e9a09b.js";import{M as G}from"./react-tooltip.min.a2f274fb.js";/* empty css                          */import{M as J}from"./Modal.81054d6f.js";import{P as Q}from"./PrimaryButton.dc200cb7.js";import"./index.6e860bb5.js";import"./iconBase.9b35345f.js";import"./InputLabel.4e4122f6.js";import"./Textarea.8137cc1e.js";import"./NumberInput.9b099d76.js";import"./index.e7e076b2.js";import"./transition.cfd51e90.js";function ge({streamer:i,forceScroll:_=!1}){const[w,I]=a.exports.useState([]),[v,y]=a.exports.useState(""),[M,C]=a.exports.useState(!1),[Y,T]=a.exports.useState(0),{auth:c,pusher:q}=k().props,[h,f]=a.exports.useState(!1),[o,g]=a.exports.useState(null),[U,p]=a.exports.useState(null),{coins_sound:F}=k().props;new Audio(F);const x=a.exports.useRef(),B=`room-${i.username}`,$=e=>{var l;((l=c==null?void 0:c.user)==null?void 0:l.id)===i.id&&i.id!==e&&(p(null),g(null),f(!h),u.post(route("profile.modalUserInfo",{user:e})).then(n=>{g(n.data)}).catch(n=>d.error(t("Error loading user infos for the modal"))))},E=(e,l)=>{e.preventDefault(),u.post(route("channel.banUserFromRoom",{user:l})).then(n=>{d.success(t("User has been banned!")),g(null),p(null),f(!h)}).catch(n=>d.error(t("Error banning user")))},H=e=>{const l=e.scrollTop+e.clientHeight;l==e.scrollHeight?C(!1):C(!0),T(l)},b=()=>{var e;if(!M){const{offsetHeight:l,scrollHeight:n,scrollTop:K}=x.current;(e=x.current)==null||e.scrollTo(0,n)}};a.exports.useEffect(()=>{b()},[w]),a.exports.useEffect(()=>{u.get(route("chat.latestMessages",{roomName:B})).then(e=>{I(e.data)}).catch(e=>d.error(`Loading latest messages: ${e.message}`)),_&&b()},[]);const j=e=>{e.preventDefault(),u.post(route("chat.sendMessage",{user:i.id}),{message:v}).then(()=>y("")).catch(l=>{var n;d.error((n=l.response.data)==null?void 0:n.message)}),b()};return r("div",{className:"flex flex-col w-full lg:w-[400px] h-[270px] sm:h-[360px] lg:h-[536px] bg-white dark:bg-zinc-900 dark:border-zinc-900 ",children:[r(J,{show:h,onClose:e=>f(!1),children:[!o&&t("Loading user infos.."),o&&s("div",{className:"p-5 text-gray-600 dark:text-gray-100 text-lg",children:r("div",{className:"flex items-center",children:[s("div",{children:s("img",{src:o.profile_picture,alt:"",className:"rounded-full w-20 border-2 border-indigo-100"})}),r("div",{className:"pl-3 flex-grow",children:[s("h3",{className:"text-lg font-semibold",children:o.name}),r("p",{className:"text-sm",children:["@",o.username]}),s("p",{className:"text-sm flex",children:o.channel_follower?r(m,{children:[s(N,{className:"mt-0.5 mr-1"}),t("Follows your channel")]}):r(m,{children:[s(N,{className:"mt-0.5 mr-1"}),t("Doesn't follow your channel")]})}),s("p",{className:"text-sm flex",children:o.channel_follower?r(m,{children:[s(S,{className:"mt-0.5 mr-1"}),t("Subscribed on Tier: :tier",{tier:o.membership_tier})]}):r(m,{children:[s(S,{className:"mt-0.5 mr-1"}),t("Not subscribed to your channel")]})})]}),s("div",{className:"justify-end",children:o.is_user_banned?s("p",{children:t("Banned on :date",{date:o.banned_date})}):U===null?r(Q,{onClick:e=>p(o.id),children:[s(D,{className:"mr-1"}),t("Ban User")]}):r(m,{children:[t("Are you sure?"),s("br",{}),s("button",{onClick:e=>E(e,o.id),className:"text-red-600 hover:underline font-semibold",children:t("Yes, ban")}),s("button",{onClick:e=>p(null),className:"ml-2 text-indigo-500 hover:underline font-semibold",children:t("Cancel")})]})})]})})]}),r("div",{ref:x,onScroll:e=>H(e.currentTarget),className:"flex-grow  text-gray-700 text-sm dark:text-white pl-2  relative overflow-scroll",children:[r("h3",{className:"font-semibold pt-5 text-lg flex items-center justify-center",children:[s(L,{className:"mr-2"}),t("Live Chat")]}),w.map(e=>r("p",{className:`py-2 ${e.tip>0&&"bg-yellow-200 rounded-lg p-2 text-gray-900 my-2"}`,children:[e.user_id===i.id&&s("span",{children:s(A,{"data-tooltip-content":t("Channel Owner"),"data-tooltip-id":`chatmsg-follower-${e.id}`,className:"-mt-0.5 mr-1 inline text-pink-600"})}),e.isFollower&&s("span",{children:s(N,{"data-tooltip-content":t("Channel Follower"),"data-tooltip-id":`chatmsg-follower-${e.id}`,className:"mr-1 inline text-cyan-600"})}),e.isSubscriber&&s("span",{children:s(S,{"data-tooltip-content":t("Channel Subscriber"),"data-tooltip-id":`chatmsg-subscriber-${e.id}`,className:"mr-1 inline text-fuchsia-500"})}),s(G,{anchorSelect:"svg"}),r("span",{onClick:l=>$(e.user_id),className:`font-semibold cursor-pointer ${e.user_id===i.id?"text-pink-600":"text-indigo-500 dark:text-indigo-400"}`,children:[e.user.username,": "]}),e.tip>0&&t("Just tipped :tip tokens! ",{tip:e.tip}),s("span",{className:"break-all",children:e.message})]},`msg-${e.id}`))]}),r("div",{className:"py-5 px-2 flex items-center",children:[r("div",{className:"mr-2 flex-grow",children:[c.user&&s("form",{onSubmit:j,children:s(P,{name:"chat_message",className:"w-full",placeholder:t("Enter message & press enter"),value:v,handleChange:e=>y(e.target.value)})}),!c.user&&s(z,{className:"w-full py-3",onClick:e=>O.Inertia.visit(route("login")),children:t("Login to Chat")})]}),s("div",{children:s(R,{streamer:i})})]})]})}export{ge as default};
